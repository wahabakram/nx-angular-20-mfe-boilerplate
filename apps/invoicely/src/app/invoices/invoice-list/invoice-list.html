<mf-panel>
  <mf-panel-header class="px-10 h-16">
    <div class="border-b border-b-default h-full flex items-center justify-between">
      <div class="flex items-center gap-5">
        <div class="text-lg font-bold">Invoices</div>
        <mf-vertical-divider />
        @if (selectedRows().length === 0) {
          <mf-segmented [(ngModel)]="status">
            <button mf-segmented-button value="all">All</button>
            <button mf-segmented-button value="draft">Draft</button>
            <button mf-segmented-button value="sent">Sent</button>
            <button mf-segmented-button value="paid">Paid</button>
            <button mf-segmented-button value="overdue">Overdue</button>
          </mf-segmented>
          <mf-vertical-divider />
          <input
            type="text"
            placeholder="Search invoices..."
            [(ngModel)]="search"
            class="border-b border-b-default h-10 w-96 text-sm bg-transparent outline-0 focus-within:border-neutral-950">
        } @else {
          <div class="text-sm">Selected <span class="font-bold">{{ selectedRows().length }}</span></div>
          <mf-vertical-divider />
          <div class="flex items-center gap-4">
            <button mat-stroked-button color="warn" (click)="deleteSelected()">
              <mat-icon>delete</mat-icon>Delete
            </button>
          </div>
        }
      </div>
      <div>
        <button mat-flat-button color="primary" (click)="createInvoice()">
          <mat-icon>add</mat-icon> New Invoice
        </button>
      </div>
    </div>
  </mf-panel-header>

  <mf-panel-body>
    <mf-data-view
      class="px-10"
      [columnDefs]="columnDefs"
      [data]="filteredData"
      [paginator]="paginator"
      [search]="search()"
      hoverRows
      withSelection
      stickyHeader
      highlightHeader
      (rowSelectionChanged)="rowSelectionChanged($event)"
      (selectionChanged)="selectionChanged($event)"
      (allRowsSelectionChanged)="allRowsSelectionChanged($event)">

      <ng-template mfDataViewEmptyData>
        <mf-block-state>
          <mf-block-state-icon>
            <mat-icon>receipt_long</mat-icon>
          </mf-block-state-icon>
          <mf-block-state-content>
            <h3>No invoices yet</h3>
            <p>Create your first invoice to get started</p>
            <button mat-raised-button color="primary" (click)="createInvoice()">
              <mat-icon>add</mat-icon> Create Invoice
            </button>
          </mf-block-state-content>
        </mf-block-state>
      </ng-template>

      <ng-template mfDataViewEmptyFilterResults>
        <mf-block-state>
          <mf-block-state-icon>
            <mat-icon>search_off</mat-icon>
          </mf-block-state-icon>
          <mf-block-state-content>No invoices matching "{{ search() }}"</mf-block-state-content>
        </mf-block-state>
      </ng-template>

      <mf-data-view-action-bar #dataViewActionBar="mfDataViewActionBar" *mfDataViewActionBar="let row">
        <button mat-stroked-button (click)="viewInvoice(row)">View</button>
        <button mat-stroked-button (click)="editInvoice(row)">Edit</button>
        <button
          mat-icon-button
          [matMenuTriggerFor]="menu"
          (menuOpened)="currentActionRow.set(row); dataViewActionBar.api.setForceVisible(true)"
          (menuClosed)="dataViewActionBar.api.setForceVisible(false)">
          <mat-icon>more_horiz</mat-icon>
        </button>
      </mf-data-view-action-bar>

      <mat-menu #menu="matMenu">
        @if (currentActionRow()) {
          <button mat-menu-item (click)="sendInvoice(currentActionRow()!)">
            <mat-icon>send</mat-icon>
            <span>Send Invoice</span>
          </button>
          <button mat-menu-item (click)="markAsPaid(currentActionRow()!)">
            <mat-icon>check_circle</mat-icon>
            <span>Mark as Paid</span>
          </button>
          <button mat-menu-item (click)="downloadPdf(currentActionRow()!)">
            <mat-icon>download</mat-icon>
            <span>Download PDF</span>
          </button>
          <button mat-menu-item (click)="deleteInvoice(currentActionRow()!)">
            <mat-icon>delete</mat-icon>
            <span>Delete</span>
          </button>
        }
      </mat-menu>
    </mf-data-view>
  </mf-panel-body>

  <mf-panel-footer class="px-10 h-20 flex items-center justify-center border-t border-t-default">
    <mat-paginator #paginator pageSize="20" [pageSizeOptions]="[10, 20, 50]" showFirstLastButtons />
  </mf-panel-footer>
</mf-panel>
