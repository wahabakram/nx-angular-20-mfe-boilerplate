<!-- Business Sidebar Component -->
<aside [class]="sidebarClasses()" class="flex flex-col">
  <!-- Brand Header (Fixed) -->
  <div class="flex items-center gap-3 mb-6 flex-shrink-0">
    <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center">
      <span class="text-primary-content font-bold text-lg">{{ defaultConfig().brandIcon }}</span>
    </div>
    @if (!defaultConfig().compactMode) {
      <div>
        <h2 class="text-lg font-bold">{{ defaultConfig().brandName }}</h2>
        <p class="text-xs">{{ defaultConfig().brandSubtitle }}</p>
      </div>
    }
  </div>

  <!-- Workspace Selector Dropdown (Fixed) -->
  @if (defaultConfig().showWorkspaceSelector && workspaces().length > 0 && !defaultConfig().compactMode) {
    <div class="dropdown dropdown-bottom w-full mb-6 flex-shrink-0">
      <button tabindex="0" role="button" class="btn btn-outline w-full justify-between">
        <div class="flex items-center gap-2">
          <mfc-icon name="solar:buildings-2-line-duotone" class="w-4 h-4" />
          <span>{{ selectedWorkspace()?.name || 'Select Workspace' }}</span>
        </div>
        <mfc-icon name="solar:alt-arrow-down-line-duotone" class="w-4 h-4" />
      </button>
      <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-full p-2 shadow border border-base-300">
        @for (workspace of workspaces(); track trackByWorkspace($index, workspace)) {
          <li>
            <a (click)="onWorkspaceSelected(workspace)"
               [class.active]="selectedWorkspace()?.id === workspace.id"
               role="presentation">
              <mfc-icon [name]="workspace.isDefault ? 'solar:star-line-duotone' : 'solar:buildings-2-line-duotone'"
                       class="w-4 h-4" />
              <div class="flex flex-col items-start">
                <span>{{ workspace.name }}</span>
                @if (workspace.description) {
                  <span class="text-xs">{{ workspace.description }}</span>
                }
              </div>
              @if (workspace.isDefault) {
                <div class="badge badge-xs badge-primary ml-auto">Default</div>
              }
            </a>
          </li>
        }
        <div class="divider my-1"></div>
        <li>
          <a (click)="onCreateWorkspace()" role="presentation">
            <mfc-icon name="solar:settings-line-duotone" class="w-4 h-4" />
            Manage Branches
          </a>
        </li>
      </ul>
    </div>
  }

  <!-- Menu Items (Scrollable) -->
  <nav class="flex-1 overflow-y-auto sidebar-menu-scroll">
    @for (item of menuItems(); track trackByMenuItem($index, item)) {
      @if (hasSubItems(item)) {
        <!-- Menu item with sub-items -->
        <ul class="menu menu-md mb-2 rounded-box w-full">
          <li>
            <details [open]="isExpanded(item.path)">
              <summary (click)="toggleExpanded(item.path)">
                <span class="flex items-center gap-2">
                  <mfc-icon [name]="item.icon" class="w-5 h-5" />
                  @if (!defaultConfig().compactMode) {
                    {{ item.label }}
                  }
                </span>
                @if (item.badge && !defaultConfig().compactMode) {
                  <div class="badge badge-primary badge-sm ml-auto">{{ item.badge }}</div>
                }
              </summary>
              @if (!defaultConfig().compactMode) {
                <ul>
                  @for (subItem of item.subItems; track trackByMenuItem($index, subItem)) {
                    <li>
                      <a [routerLink]="[subItem.path]"
                         routerLinkActive="menu-active"
                         [routerLinkActiveOptions]="{ exact: true }">
                        @if (subItem.icon) {
                          <mfc-icon [name]="subItem.icon" class="w-4 h-4" />
                        }
                        {{ subItem.label }}
                        @if (subItem.badge) {
                          <div class="badge badge-primary badge-xs ml-auto">{{ subItem.badge }}</div>
                        }
                      </a>
                    </li>
                  }
                </ul>
              }
            </details>
          </li>
        </ul>
      } @else {
        <!-- Simple menu item -->
        <ul class="menu menu-md mb-2 rounded-box w-full">
          <li>
            <a [routerLink]="[item.path]"
               routerLinkActive="menu-active"
               [routerLinkActiveOptions]="{ exact: true }"
               [title]="defaultConfig().compactMode ? item.label : ''">
              <mfc-icon [name]="item.icon" class="w-5 h-5" />
              @if (!defaultConfig().compactMode) {
                {{ item.label }}
              }
              @if (item.badge && !defaultConfig().compactMode) {
                <div class="badge badge-primary badge-sm ml-auto">{{ item.badge }}</div>
              }
            </a>
          </li>
        </ul>
      }
    }
  </nav>

  <!-- Bottom Section (Fixed) -->
  <div class="flex-shrink-0 pt-2 border-t border-base-300">
    <!-- User Profile -->
    @if (defaultConfig().showUserProfile && currentUser()) {
      <div class="card bg-base-100 shadow-sm mb-4 p-3">
        <div class="flex items-center gap-3">
          <div class="avatar placeholder">
            <div class="bg-primary text-primary-content rounded-full w-10">
              @if (currentUser()?.avatar) {
                <img [src]="currentUser()!.avatar" [alt]="currentUser()!.firstName" class="rounded-full">
              } @else {
                <span class="text-sm">{{ userInitials() }}</span>
              }
            </div>
          </div>
          @if (!defaultConfig().compactMode) {
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium truncate">
                {{ currentUser()!.firstName }} {{ currentUser()!.lastName }}
              </p>
              @if (currentUser()?.email) {
                <p class="text-xs truncate">
                  {{ currentUser()!.email }}
                </p>
              }
            </div>
          }
        </div>
      </div>
    }

    <!-- Logout Button -->
    <ul class="menu menu-md rounded-box w-full">
      <li>
        <a (click)="onLogout()"
           role="presentation"
           class="bg-base-200 text-error"
           [title]="defaultConfig().compactMode ? 'Logout' : ''">
          <mfc-icon name="solar:logout-2-line-duotone" class="w-5 h-5" />
          @if (!defaultConfig().compactMode) {
            Logout
          }
        </a>
      </li>
    </ul>
  </div>
</aside>