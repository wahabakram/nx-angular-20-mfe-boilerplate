<mf-panel>
  <mf-panel-header class="h-16">
    <div class="flex h-full border-b border-b-surface-container items-center justify-between gap-5 px-6">
      <div class="flex items-center gap-3">
        <a mat-icon-button routerLink="/products">
          <mat-icon>arrow_back</mat-icon>
        </a>
        <div class="text-lg font-semibold">
          {{ isEditMode() ? 'Edit Product' : 'New Product' }}
        </div>
      </div>
      <div class="flex items-center gap-4">
        <button mat-button (click)="onCancel()" [disabled]="isLoading()">
          Cancel
        </button>
        <button mat-flat-button color="primary" (click)="onSubmit()" [disabled]="isLoading() || productForm.invalid">
          @if (isLoading()) {
            <mat-spinner diameter="20" class="mr-2"></mat-spinner>
          }
          {{ isEditMode() ? 'Update Product' : 'Create Product' }}
        </button>
      </div>
    </div>
  </mf-panel-header>

  <mf-panel-body>
    <mf-overlay-scrollbar [absolute]="true">
      <div class="p-7 lg:w-[800px] lg:mx-auto">
        @if (error()) {
          <div class="mb-6 p-4 bg-error-50 dark:bg-error-900/20 text-error border-l-4 border-error rounded-r">
            <div class="flex items-center">
              <mat-icon class="mr-2">error</mat-icon>
              <span>{{ error() }}</span>
            </div>
          </div>
        }

        <form [formGroup]="productForm" class="flex flex-col gap-6">
          <!-- Basic Information -->
          <section class="card-container px-6 py-6 pb-1">
            <header class="flex items-center gap-3">
              <div class="size-11 rounded-lg flex items-center justify-center bg-primary-200 dark:bg-primary-900/30">
                <mat-icon>inventory_2</mat-icon>
              </div>
              <div class="font-semibold">Basic Information</div>
            </header>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
              <mat-form-field class="w-full">
                <mat-label>Product Name</mat-label>
                <input matInput formControlName="name" required>
                @if (hasError('name', 'required')) {
                  <mat-error>{{ getErrorMessage('name') }}</mat-error>
                }
                @if (hasError('name', 'minlength')) {
                  <mat-error>{{ getErrorMessage('name') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>SKU</mat-label>
                <input matInput formControlName="sku" required>
                @if (hasError('sku', 'required')) {
                  <mat-error>{{ getErrorMessage('sku') }}</mat-error>
                }
                @if (hasError('sku', 'minlength')) {
                  <mat-error>{{ getErrorMessage('sku') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>Barcode</mat-label>
                <input matInput formControlName="barcode" placeholder="Optional">
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>Status</mat-label>
                <mat-select formControlName="status" required>
                  @for (status of statusOptions; track status.value) {
                    <mat-option [value]="status.value">{{ status.label }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>
            </div>

            <mat-form-field class="w-full">
              <mat-label>Description</mat-label>
              <textarea matInput formControlName="description" rows="3" placeholder="Optional"></textarea>
            </mat-form-field>
          </section>

          <!-- Pricing -->
          <section class="card-container px-6 py-6 pb-1">
            <header class="flex items-center gap-3">
              <div class="size-11 rounded-lg flex items-center justify-center bg-green-200 dark:bg-green-900/30">
                <mat-icon>attach_money</mat-icon>
              </div>
              <div class="font-semibold">Pricing</div>
            </header>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
              <mat-form-field class="w-full">
                <mat-label>Selling Price</mat-label>
                <input matInput type="number" formControlName="price" required min="0" step="0.01">
                <span matTextPrefix>$&nbsp;</span>
                @if (hasError('price', 'required')) {
                  <mat-error>{{ getErrorMessage('price') }}</mat-error>
                }
                @if (hasError('price', 'min')) {
                  <mat-error>{{ getErrorMessage('price') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>Cost Price</mat-label>
                <input matInput type="number" formControlName="costPrice" required min="0" step="0.01">
                <span matTextPrefix>$&nbsp;</span>
                @if (hasError('costPrice', 'required')) {
                  <mat-error>{{ getErrorMessage('costPrice') }}</mat-error>
                }
                @if (hasError('costPrice', 'min')) {
                  <mat-error>{{ getErrorMessage('costPrice') }}</mat-error>
                }
              </mat-form-field>
            </div>
          </section>

          <!-- Inventory Management -->
          <section class="card-container px-6 py-6 pb-1">
            <header class="flex items-center gap-3">
              <div class="size-11 rounded-lg flex items-center justify-center bg-blue-200 dark:bg-blue-900/30">
                <mat-icon>warehouse</mat-icon>
              </div>
              <div class="font-semibold">Inventory Management</div>
            </header>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
              <mat-form-field class="w-full">
                <mat-label>Current Stock Level</mat-label>
                <input matInput type="number" formControlName="stockLevel" required min="0">
                @if (hasError('stockLevel', 'required')) {
                  <mat-error>{{ getErrorMessage('stockLevel') }}</mat-error>
                }
                @if (hasError('stockLevel', 'min')) {
                  <mat-error>{{ getErrorMessage('stockLevel') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>Unit</mat-label>
                <mat-select formControlName="unit" required>
                  @for (unit of unitOptions; track unit.value) {
                    <mat-option [value]="unit.value">{{ unit.label }}</mat-option>
                  }
                </mat-select>
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>Low Stock Threshold</mat-label>
                <input matInput type="number" formControlName="lowStockThreshold" required min="0">
                @if (hasError('lowStockThreshold', 'required')) {
                  <mat-error>{{ getErrorMessage('lowStockThreshold') }}</mat-error>
                }
                @if (hasError('lowStockThreshold', 'min')) {
                  <mat-error>{{ getErrorMessage('lowStockThreshold') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>Reorder Point</mat-label>
                <input matInput type="number" formControlName="reorderPoint" required min="0">
                @if (hasError('reorderPoint', 'required')) {
                  <mat-error>{{ getErrorMessage('reorderPoint') }}</mat-error>
                }
                @if (hasError('reorderPoint', 'min')) {
                  <mat-error>{{ getErrorMessage('reorderPoint') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>Maximum Stock Level</mat-label>
                <input matInput type="number" formControlName="maxStockLevel" required min="0">
                @if (hasError('maxStockLevel', 'required')) {
                  <mat-error>{{ getErrorMessage('maxStockLevel') }}</mat-error>
                }
                @if (hasError('maxStockLevel', 'min')) {
                  <mat-error>{{ getErrorMessage('maxStockLevel') }}</mat-error>
                }
              </mat-form-field>
            </div>
          </section>

          <!-- Additional Information -->
          <section class="card-container px-6 py-6 pb-1">
            <header class="flex items-center gap-3">
              <div class="size-11 rounded-lg flex items-center justify-center bg-purple-200 dark:bg-purple-900/30">
                <mat-icon>category</mat-icon>
              </div>
              <div class="font-semibold">Additional Information</div>
            </header>
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 gap-4">
              <mat-form-field class="w-full">
                <mat-label>Category ID</mat-label>
                <input matInput type="number" formControlName="categoryId" required>
                @if (hasError('categoryId', 'required')) {
                  <mat-error>{{ getErrorMessage('categoryId') }}</mat-error>
                }
              </mat-form-field>

              <mat-form-field class="w-full">
                <mat-label>Supplier ID</mat-label>
                <input matInput type="number" formControlName="supplierId" placeholder="Optional">
              </mat-form-field>
            </div>
          </section>

          <!-- Product Image -->
          <section class="card-container px-6 py-6 pb-1">
            <header class="flex items-center gap-3">
              <div class="size-11 rounded-lg flex items-center justify-center bg-orange-200 dark:bg-orange-900/30">
                <mat-icon>image</mat-icon>
              </div>
              <div class="font-semibold">Product Image</div>
            </header>
            <div class="mt-8">
                <app-image-upload
                [imageUrl]="productForm.get('imageUrl')?.value ?? null"
                (imageUrlChange)="productForm.patchValue({ imageUrl: $event ?? undefined })">
              </app-image-upload>
            </div>
          </section>
        </form>
      </div>
    </mf-overlay-scrollbar>
  </mf-panel-body>
</mf-panel>
