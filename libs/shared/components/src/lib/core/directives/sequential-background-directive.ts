import { Directive, effect, inject, OnDestroy, signal } from '@angular/core';
import { ColorSchemeStore } from '../../color-scheme';

@Directive({
  selector: '[mfSequentialBackground]',
  host: {
    '[style.background-color]': 'backgroundColor()',
  },
})
export class SequentialBackgroundDirective implements OnDestroy {
  private colorSchemeStore = inject(ColorSchemeStore);

  private static instanceCounter = 0;
  private static readonly LIGHT_MUTED_COLORS: ReadonlyArray<string> = [
    '#E9F0EE',
    '#EDF2EE',
    '#F2F5EC',
    '#F9F8ED',
    '#FEFCF2',
    '#FCF3E9',
    '#FBF0E1',
    '#F9E9DA',
    '#F7E2D1',
    '#F6DBC9',
    '#E0DFDD',
    '#E3E2E1',
    '#E8E8E5',
    '#ECEBEB',
    '#F1F1F0',
    '#E2E9E9',
    '#E5EDED',
    '#E8F0F0',
    '#EDF3F3',
    '#F1F1F1',
    '#EBEFF0',
    '#EEF2F2',
    '#F0F4F5',
    '#F3F5F7',
    '#F6F7F9',
    '#EEEDED',
    '#F1F0F1',
    '#F4F3F4',
    '#F6F4F4',
    '#F9F6F6',
    '#EBEDEB',
    '#EFF2EF',
    '#F1F4F1',
    '#F3F6F3',
    '#F6F9F6',
    '#EBEDEE',
    '#EFF2F2',
    '#F1F4F5',
    '#F3F6F6',
    '#F6F9F9',
    '#EDEBED',
    '#F1F0F2',
    '#F4F3F4',
    '#F6F4F6',
    '#F9F6F9',
    '#EDF0EB',
    '#F1F1F1',
    '#F4F4F3',
    '#F6F6F6',
    '#F9F9F6',
    '#F7F0EC',
    '#F4EEE8',
    '#F1EBE6',
    '#EEE7E2',
    '#EBE3E1',
    '#EBF1F7',
    '#E8F4F4',
    '#E5EDED',
    '#E3EDED',
    '#E1EBEB',
    '#EEE9EA',
    '#EBE4E3',
    '#E8E2DF',
    '#E5DAD8',
    '#E4DED4',
    '#EAEFF0',
    '#E5E9EB',
    '#E1E5E1',
    '#DDE3DE',
    '#D9DFD9',
    '#F7F7F7',
    '#F2F2F2',
    '#ECECEC',
    '#E6E6E6',
    '#E0E0E0',
    '#D8D8D8',
    '#D0D0D0',
    '#C8C8C8',
    '#C0C0C0',
    '#B8B8B8',
    '#F3F0E9',
    '#EEECE0',
    '#E7E6D2',
    '#E1DDC3',
    '#DAD4B5',
    '#EBF4ED',
    '#DDECE8',
    '#CFE5E0',
    '#C1DFD7',
    '#B4D6CD',
    '#F0EBF4',
    '#EBE0ED',
    '#E6D2E8',
    '#E0C3E0',
    '#D9B5D8',
    '#EBEBF4',
    '#E0E0ED',
    '#D2D2E8',
    '#C3C3E0',
    '#B5B5D8',
  ];
  private static readonly DARK_MUTED_COLORS: ReadonlyArray<string> = [
    '#a2b8c5',
    '#a7bfca',
    '#b9c5b9',
    '#c3c9ba',
    '#cbc8c0',
    '#c9c0b9',
    '#c8bdad',
    '#c5b8a9',
    '#c3b1a2',
    '#c1ab9a',
    '#b1b0af',
    '#b3b2b1',
    '#b6b6b5',
    '#b8b8b8',
    '#bcbcbc',
    '#b3c5c5',
    '#b5caca',
    '#b8cccc',
    '#b9d0cf',
    '#bcbcbc',
    '#b8bdbe',
    '#bac0c0',
    '#bcc2c2',
    '#bf_c4c5',
    '#c1c6c7',
    '#babadb',
    '#bdbdbc',
    '#c0bf_c0',
    '#c1c0c1',
    '#c3c2c3',
    '#b8bab8',
    '#bcc0bc',
    '#bec2be',
    '#c0c5c0',
    '#c1c7c2',
    '#b8bab9',
    '#bcc0c0',
    '#bec2c2',
    '#c0c5c5',
    '#c1c7c7',
    '#bab8ba',
    '#bdbdbe',
    '#c0bfc0',
    '#c1c0c2',
    '#c3c2c3',
    '#b9bc_b8',
    '#bcbcbc',
    '#c0c0bf',
    '#c2c2c2',
    '#c3c3c1',
    '#c2bcb9',
    '#c0b_ab7',
    '#beb8b5',
    '#bba_b1',
    '#b8b2af',
    '#b8bec3',
    '#b6c8c8',
    '#b5c5c5',
    '#b3c5c5',
    '#b1c3c3',
    '#baba_b9',
    '#b8b5b2',
    '#b6b3b0',
    '#b5adab',
    '#b2aca6',
    '#b7bdbe',
    '#b5b8ba',
    '#b1b4b1',
    '#aeb2ae',
    '#abb0ab',
    '#c2c2c2',
    '#bcbcbc',
    '#b8b8b8',
    '#b0b0b0',
    '#a8a8a8',
    '#a2a2a2',
    '#9a9a9a',
    '#929292',
    '#8a8a8a',
    '#828282',
    '#c4c2b9',
    '#bfbda_b1',
    '#b9b9a5',
    '#b1b09b',
    '#aca991',
    '#b8c5ba',
    '#aeb9b6',
    '#a3b4a_e',
    '#99ad_a5',
    '#8ea49c',
    '#c0b8c2',
    '#b8a_fb9',
    '#b6a5b6',
    '#b096b0',
    '#aa8aaa',
    '#b8b8c2',
    '#b0b0b9',
    '#a5a5b6',
    '#9696b0',
    '#8a8aa',
  ];

  readonly backgroundColor = signal<string | null>(null);

  private colorIndex = -1;

  constructor() {
    this.colorIndex =
      SequentialBackgroundDirective.instanceCounter %
      SequentialBackgroundDirective.LIGHT_MUTED_COLORS.length;
    SequentialBackgroundDirective.instanceCounter++;

    effect(() => {
      if (this.colorIndex === -1) {
        return;
      }

      const MUTED_COLORS =
        this.colorSchemeStore.theme() === 'light'
          ? SequentialBackgroundDirective.LIGHT_MUTED_COLORS
          : SequentialBackgroundDirective.DARK_MUTED_COLORS;
      this.backgroundColor.set(MUTED_COLORS[this.colorIndex]);
    });
  }

  ngOnDestroy() {
    SequentialBackgroundDirective.instanceCounter--;
  }
}
