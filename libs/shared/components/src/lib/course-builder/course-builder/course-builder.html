<div class="flex flex-col gap-10">
  @for (module of course().modules; track module; let index = $index) {
    <div class="card-container px-7 pt-4 pb-5">
      @if (module.loading) {
        <mf-skeleton>
          <mf-skeleton-block class="h-10"/>
        </mf-skeleton>
      } @else {
        <div class="flex items-center justify-between mb-3">
          <div class="grow pe-7">
            <h3 class="text-xl font-semibold leading-[2]" mf-inline-text-edit
                (changed)="onModuleNameChanged($event, module.id)">{{ module.name }}</h3>
          </div>
        </div>
        <div class="flex flex-col gap-4">
          @for (item of module.items; track item; let index = $index) {
            @if (item.loading) {
              <mf-skeleton>
                <mf-skeleton-block class="h-14"/>
              </mf-skeleton>
            } @else {
              @switch (item.type) {
                @case ('lesson') {
                  <div class="bg-surface-container-low rounded-3xl px-5 py-3 flex items-center justify-between gap-3">
                    <mf-inline-text-edit class="grow leading-[2]" (changed)="onLessonNameChanged($event, item.lesson.id)">
                      {{ item.lesson.name }}
                    </mf-inline-text-edit>
                    <div class="flex items-center justify-between -me-2">
                      <a [routerLink]="lessonUrl(item.lesson)" mat-button>Edit</a>
                      <button mat-icon-button>
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>
                }
                @case ('quiz') {
                  <div class="bg-surface-container-low rounded-3xl px-5 py-3 flex items-center justify-between gap-3">
                    <mf-inline-text-edit class="grow leading-[2]" (changed)="onQuizNameChanged($event, item.quiz.id)">
                      {{ item.quiz.name }}
                    </mf-inline-text-edit>
                    <div class="flex items-center justify-between -me-2">
                      <a [routerLink]="quizUrl(item.quiz)" mat-button>Edit</a>
                      <button mat-icon-button>
                        <mat-icon>delete</mat-icon>
                      </button>
                    </div>
                  </div>
                }
              }
            }
          } @empty {
            <div class="text-sm text-neutral-600">
              There are no lessons yet.
            </div>
          }
        </div>
        <div class="mt-7 border-t border-t-default pt-5">
          <div class="flex items-center gap-3">
            <button mat-raised-button (click)="addLesson(module)">Add Lesson</button>
            <button mat-raised-button (click)="addQuiz(module)">Add Quiz</button>
            <button mat-icon-button>
              <mat-icon>arrow_downward</mat-icon>
            </button>
            <button mat-icon-button>
              <mat-icon>arrow_upward</mat-icon>
            </button>
            <button mat-icon-button class="ms-auto">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </div>
      }
    </div>
  } @empty {
    <div class="text-sm text-neutral-600">There are no modules yet.</div>
  }
  <div>
    <button mat-flat-button (click)="newModule()">Add Module</button>
  </div>
</div>
